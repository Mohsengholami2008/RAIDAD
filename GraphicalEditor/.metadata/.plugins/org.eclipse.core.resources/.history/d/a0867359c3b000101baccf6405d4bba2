import numpy as np
import warnings
np.warnings = warnings
import pandas as pd
from sklearn.impute import SimpleImputer
from pyclustering.cluster.kmeans import kmeans
from pyclustering.cluster.center_initializer import kmeans_plusplus_initializer
import matplotlib.pyplot as plt


def read_csv(file_path):
    data = pd.read_csv(file_path, )
    return data







import logging
def fill_missing_values(data, impute_configurations):
    if not impute_configurations:
        raise ValueError("No imputation configurations provided")
    
    for config in impute_configurations:
        column_names = config.get('column_names')
        if not all(col in data.columns for col in column_names):
            logger.error(f"One or more columns not found in the data: {column_names}")
            raise KeyError(f"One or more columns missing from data: {column_names}")
            
        try:
            imputer = SimpleImputer(
                missing_values=config.get('missing_values', np.nan),
                strategy=config.get('strategy', 'mean'),
                fill_value=config.get('fill_value')
            )
            data[column_names] = imputer.fit_transform(data[column_names])
            logger.info(f"Imputed missing values in columns: {column_names}")
        except Exception as e:
            logger.error(f"An error occurred during imputation: {e}")
            raise
    return data
logger = logging.getLogger(__name__)


def remove_duplicates(data, remove_duplicates_columns=None):
    if remove_duplicates_columns is None:
        data = data.drop_duplicates()
    else:
        subset = remove_duplicates_columns.get('subset', None)
        keep = remove_duplicates_columns.get('keep', 'first')
        data = data.drop_duplicates(subset=subset, keep=keep)

    return data























def build_kmeans(KMeans_params, data):
    initial_centers = kmeans_plusplus_initializer(data.values, KMeans_params['n_clusters']).initialize()
    kmeans_instance = kmeans(data.values, initial_centers)
    kmeans_instance.process()
    clusters = kmeans_instance.get_clusters()
    cluster_centers = kmeans_instance.get_centers()
    labels = [-1] * len(data)
    for cluster_idx, cluster in enumerate(clusters):
        for sample_idx in cluster:
            labels[sample_idx] = cluster_idx
    
    # Calculate statistics for cluster centers
    cluster_centers_stats = {
        f'Cluster {idx + 1} Mean': np.mean(center) for idx, center in enumerate(cluster_centers)
    }
    
    # Print cluster centers statistics
    print("Cluster Centers Statistics:")
    for key, value in cluster_centers_stats.items():
        print(f"{key}: {value}")
  	
    # Plot scatter plot of data points colored by clusters
    plt.figure(figsize=(8, 6))
    for cluster_idx, cluster in enumerate(clusters):
        cluster_data = data.iloc[cluster]
        plt.scatter(cluster_data.iloc[:, 0], cluster_data.iloc[:, 1], label=f'Cluster {cluster_idx + 1}')
    plt.scatter(np.array(cluster_centers)[:, 0], np.array(cluster_centers)[:, 1], color='black', marker='x', label='Cluster Centers')
    plt.xlabel('Feature 1')
    plt.ylabel('Feature 2')
    plt.title('Scatter Plot of Data Points Colored by Clusters')
    plt.legend()
    plt.show()

    return labels, cluster_centers








def process_data(data=None, remove_duplicates_columns=None, impute_configurations=None, KMeans_params=None, ): 
	executed_functions = []
	model = None	

	a =['Duplicates','Simple_Imputer','K_Means','Cluster_Evaluation','invalid']

	for letter in range (len(a)):
		if a[letter] == 'Simple_Imputer': 
			data = fill_missing_values(data, impute_configurations)
			executed_functions.append('fill_missing_values')














		if a[letter] == 'Duplicates':
			data = remove_duplicates(data, remove_duplicates_columns)
			executed_functions.append('remove_duplicates')
			print(data.head())
















		if a[letter] == 'K_Means':
			labels, cluster_centers = build_kmeans(KMeans_params, data)
			model = {'labels': labels, 'cluster_centers': cluster_centers}
			executed_functions.append('build_kmeans')










	return data, executed_functions, model

if __name__ == "__main__":
    file_path = 'C:\Users\ShemrounShop\Desktop\dataset\iris.csv'
    data = read_csv(file_path)
    data = data.drop(columns=['Species'])












    impute_configurations = [
        {
            'column_names': ['SepalWidthCm', 'PetalLengthCm', 'PetalWidthCm', 'SepalLengthCm'],

       		'strategy': 'mean',


        },
    ]


























    KMeans_params = {
        'n_clusters': 5,
        'init': 'k-means++',
        'n_init': 10,
        'max_iter': 300,
        'random_state': 0
    }













    remove_duplicates_columns = {

        'keep': 'first',
    }

    scoring_metrics = {
    }

    processed_data, executed_functions, model = process_data(


        data=data,

 
















 
















 








        remove_duplicates_columns=remove_duplicates_columns,








 











        KMeans_params=KMeans_params,






 

   	 impute_configurations=impute_configurations,
		














		
		


    )



